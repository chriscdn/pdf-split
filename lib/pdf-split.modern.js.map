{"version":3,"file":"pdf-split.modern.js","sources":["../node_modules/@chriscdn/promise-semaphore/lib/promise-semaphore.modern.js","../src/index.ts"],"sourcesContent":["const e=\"_default\",t=e=>[\"string\",\"number\"].includes(typeof e),s=s=>{var r;return null!=(r=t(s)?s:s.key)?r:e};class r{constructor(e){this.queue=void 0,this.maxConcurrent=void 0,this.count=void 0,this.queue=[],this.maxConcurrent=e,this.count=0}get canAcquire(){return this.count<this.maxConcurrent}incrementCount(){this.count++}decrementCount(){this.count--}acquire(e){return this.canAcquire?(this.incrementCount(),Promise.resolve()):new Promise(t=>{this.queue.push({resolve:t,priority:e}),this.queue.sort((e,t)=>t.priority-e.priority)})}release(){const e=this.queue.shift();e?setTimeout(e.resolve,0):this.decrementCount()}}class n{constructor(e=1){if(this.semaphoreInstances=void 0,this.maxConcurrent=void 0,this.semaphoreInstances={},this.maxConcurrent=e,e<1)throw new Error(\"The maxConcurrent must be 1 or greater.\")}hasSemaphoreInstance(t=e){return Boolean(this.semaphoreInstances[t])}getSemaphoreInstance(t=e){return this.hasSemaphoreInstance(t)||(this.semaphoreInstances[t]=new r(this.maxConcurrent)),this.semaphoreInstances[t]}tidy(t=e){this.hasSemaphoreInstance(t)&&0===this.getSemaphoreInstance(t).count&&delete this.semaphoreInstances[t]}canAcquire(t=e){const r=s(t);return!this.hasSemaphoreInstance(r)||this.getSemaphoreInstance(r).canAcquire}acquire(r=e){const n=s(r),i=null!=(o=t(a=r)?0:a.priority)?o:0;var a,o;return this.getSemaphoreInstance(n).acquire(i)}release(t=e){const r=s(t);this.getSemaphoreInstance(r).release(),this.tidy(r)}count(t=e){const r=s(t);return this.hasSemaphoreInstance(r)?this.getSemaphoreInstance(r).count:0}hasTasks(t=e){return this.count(t)>0}async request(t,s=e){try{return await this.acquire(s),await t()}finally{this.release(s)}}async requestIfAvailable(t,s=e){return this.canAcquire(s)?this.request(t,s):null}}class i{constructor(){this._semaphore=new n,this._activeCounts={},this._groupWaiters={}}async acquire(e){var t,s;const r=null!=(t=this._activeCounts[e])?t:0;this._activeCounts[e]=r+1;const n=null!=(s=this._groupWaiters[e])?s:this._semaphore.acquire();this._groupWaiters[e]=n,await n}release(e){const t=this._activeCounts[e];1===t?(this._semaphore.release(),delete this._activeCounts[e],delete this._groupWaiters[e]):this._activeCounts[e]=t-1}}export{i as GroupSemaphore,n as Semaphore};\n//# sourceMappingURL=promise-semaphore.modern.js.map\n","import { promisify } from \"util\";\nimport { exec as _exec } from \"child_process\";\nimport path from \"path\";\nimport fs from \"fs/promises\";\nimport { FileCache, FileCacheOptions, FilePath } from \"@chriscdn/file-cache\";\nimport { Semaphore } from \"@chriscdn/promise-semaphore\";\nimport { pathExists } from \"path-exists\";\n\nimport { Memoize } from \"@chriscdn/memoize\";\nimport sha1 from \"sha1\";\n\nconst semaphore = new Semaphore();\nconst execPromise = promisify(_exec);\n\nenum Rotate {\n    DEG_0 = 0,\n    DEG_90 = 90,\n    DEG_180 = 180,\n    DEG_270 = 270,\n}\n\ntype PDFArgs = {\n    pdfFilePath: FilePath;\n    pageIndex: number; // 0-based\n    rotate?: Rotate;\n};\n\ntype PDFCpuPageInfo = {\n    source: string;\n    pageCount: number;\n    version: string;\n    title: string;\n    producer: string;\n    encrypted: boolean;\n    pageSizes: Array<{ width: number; height: number }>;\n};\n\ntype PDFCpuInfo = {\n    header: {\n        version: string;\n        creation: string;\n    };\n    infos: PDFCpuPageInfo[];\n};\n\nexport type PDFSplitFileCacheOptions =\n    & Omit<\n        FileCacheOptions<PDFArgs>,\n        \"cb\" | \"ext\"\n    >\n    & {\n        pdfcpu?: FilePath;\n    };\n\nconst randomDirectoryName = (l = 16) =>\n    [...Array(l)].map(() => Math.random().toString(36)[2]).join(\"\");\n\nconst quote = (text: string) => `\"${text}\"`;\n\nclass PDFSplitFileCache extends FileCache<PDFArgs> {\n    private pdfcpu: FilePath;\n\n    constructor(args: PDFSplitFileCacheOptions) {\n        // Make a standalone function that can be recursively called.\n        const cb = async (\n            filePath: FilePath,\n            { pdfFilePath, pageIndex, rotate }: PDFArgs,\n        ) => {\n            const rotateResolved = rotate ?? Rotate.DEG_0;\n\n            if (rotateResolved === Rotate.DEG_0) {\n                try {\n                    // The semaphore prevents multiple consecutive calls (with\n                    // different page numbers) from running the full extraction\n                    // again.\n                    await semaphore.acquire(pdfFilePath);\n\n                    if (await pathExists(filePath)) {\n                        // all done\n                    } else {\n                        // Create a _temp directory in the cache directory to\n                        // hold the temp files. This guarantees the temp files\n                        // are stored on the same volume, which removes problems\n                        // moving the files later.\n                        //\n                        // Orphaned files and empty directories are cleaned up\n                        // by FileCache.\n                        const _thumbnailPath = path.resolve(\n                            args.cachePath,\n                            \"_temp\",\n                            randomDirectoryName(),\n                        );\n\n                        await fs.mkdir(_thumbnailPath, { recursive: true });\n\n                        const command = [\n                            this.pdfcpu,\n                            \"split\",\n                            quote(pdfFilePath),\n                            quote(_thumbnailPath),\n                        ];\n\n                        console.time(\"pdfcpu - split\");\n                        await execPromise(command.join(\" \"));\n                        console.timeEnd(\"pdfcpu - split\");\n\n                        const pdfFiles = await fs.readdir(_thumbnailPath);\n\n                        await Promise.all(pdfFiles.map(async (pdfFile) => {\n                            const match = pdfFile.match(/_(\\d+)\\.pdf$/);\n\n                            if (match?.[1]) {\n                                // The -1 makes this 0-based\n                                const _pageIndex = parseInt(match[1], 10) -\n                                    1;\n\n                                const sourceFilePath = path.join(\n                                    _thumbnailPath,\n                                    pdfFile,\n                                );\n\n                                const targetFilePath = await this\n                                    .resolveFilePath({\n                                        pdfFilePath,\n                                        pageIndex: _pageIndex,\n                                    });\n\n                                await fs.mkdir(\n                                    path.dirname(targetFilePath),\n                                    {\n                                        recursive: true,\n                                    },\n                                );\n\n                                // these should always be on the same volume, making an fs.rename possible\n                                await fs.rename(\n                                    sourceFilePath,\n                                    targetFilePath,\n                                );\n                            }\n                        }));\n\n                        // After all that, check if we have a file.\n                        if (await pathExists(filePath)) {\n                            // all good\n                        } else {\n                            throw new Error(\n                                `Invalid range or PDF: ${filePath}`,\n                            );\n                        }\n                    }\n                } finally {\n                    semaphore.release(pdfFilePath);\n                }\n            } else {\n                const sourceFilePath = await this\n                    .resolveFilePath({\n                        pdfFilePath,\n                        pageIndex,\n                    });\n\n                await cb(sourceFilePath, {\n                    pdfFilePath,\n                    pageIndex,\n                    rotate: Rotate.DEG_0,\n                });\n\n                const command = [\n                    this.pdfcpu,\n                    \"rotate\",\n                    quote(sourceFilePath),\n                    rotateResolved,\n                    filePath,\n                ];\n\n                console.time(\"pdfcpu - rotate\");\n                await execPromise(command.join(\" \"));\n                console.timeEnd(\"pdfcpu - rotate\");\n            }\n        };\n\n        super({\n            ...args,\n            ext: () => \".pdf\",\n            resolveCacheKey: ({ pdfFilePath, pageIndex, rotate }) => {\n                return sha1(\n                    JSON.stringify({\n                        pdfFilePath,\n                        pageIndex,\n                        rotate: rotate ?? Rotate.DEG_0,\n                    }),\n                );\n            },\n            cb,\n        });\n\n        this.pdfcpu = args.pdfcpu ?? \"pdfcpu\";\n        this.pdfInfo = Memoize(this.pdfInfo.bind(this));\n    }\n\n    async pdfInfo(pdfFilePath: FilePath): Promise<PDFCpuPageInfo> {\n        const command = [\n            this.pdfcpu,\n            \"info -json\",\n            quote(pdfFilePath),\n        ];\n        const { stdout } = await execPromise(command.join(\" \"));\n        const pdfCpuInfo = JSON.parse(stdout) as PDFCpuInfo;\n        return pdfCpuInfo.infos[0]!;\n    }\n\n    async pageCount(\n        pdfFilePath: FilePath,\n    ): Promise<PDFCpuPageInfo[\"pageCount\"]> {\n        const pdfInfo = await this.pdfInfo(pdfFilePath);\n        return pdfInfo.pageCount;\n    }\n\n    async pages(\n        pdfFilePath: FilePath,\n    ): Promise<FilePath[]> {\n        const pageCount = await this.pageCount(pdfFilePath);\n\n        return await Promise.all(\n            Array.from(\n                { length: pageCount },\n                (_, i) => this.getFile({ pdfFilePath, pageIndex: i }),\n            ),\n        );\n    }\n}\n\nexport { PDFSplitFileCache, Rotate };\n"],"names":["semaphore","Semaphore","execPromise","promisify","_exec","Rotate","randomDirectoryName","l","Array","map","Math","random","toString","join","quote","text","PDFSplitFileCache","FileCache","constructor","args","_this","_args$pdfcpu","cb","filePath","pdfFilePath","pageIndex","rotate","rotateResolved","DEG_0","acquire","pathExists","_thumbnailPath","path","resolve","cachePath","fs","mkdir","recursive","command","pdfcpu","console","time","timeEnd","pdfFiles","readdir","Promise","all","pdfFile","match","_pageIndex","parseInt","sourceFilePath","targetFilePath","resolveFilePath","dirname","rename","Error","release","ext","resolveCacheKey","sha1","JSON","stringify","this","pdfInfo","Memoize","bind","stdout","pdfCpuInfo","parse","infos","pageCount","pages","from","length","_","i","getFile"],"mappings":"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"}