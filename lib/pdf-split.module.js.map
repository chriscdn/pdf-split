{"version":3,"file":"pdf-split.module.js","sources":["../node_modules/@chriscdn/promise-semaphore/lib/promise-semaphore.modern.js","../src/exceptions.ts","../src/types.ts","../src/index.ts"],"sourcesContent":["const e=\"_default\",t=e=>[\"string\",\"number\"].includes(typeof e),s=s=>{var r;return null!=(r=t(s)?s:s.key)?r:e};class r{constructor(e){this.queue=void 0,this.maxConcurrent=void 0,this.count=void 0,this.queue=[],this.maxConcurrent=e,this.count=0}get canAcquire(){return this.count<this.maxConcurrent}incrementCount(){this.count++}decrementCount(){this.count--}acquire(e){return this.canAcquire?(this.incrementCount(),Promise.resolve()):new Promise(t=>{this.queue.push({resolve:t,priority:e}),this.queue.sort((e,t)=>t.priority-e.priority)})}release(){const e=this.queue.shift();e?setTimeout(e.resolve,0):this.decrementCount()}}class n{constructor(e=1){if(this.semaphoreInstances=void 0,this.maxConcurrent=void 0,this.semaphoreInstances={},this.maxConcurrent=e,e<1)throw new Error(\"The maxConcurrent must be 1 or greater.\")}hasSemaphoreInstance(t=e){return Boolean(this.semaphoreInstances[t])}getSemaphoreInstance(t=e){return this.hasSemaphoreInstance(t)||(this.semaphoreInstances[t]=new r(this.maxConcurrent)),this.semaphoreInstances[t]}tidy(t=e){this.hasSemaphoreInstance(t)&&0===this.getSemaphoreInstance(t).count&&delete this.semaphoreInstances[t]}canAcquire(t=e){const r=s(t);return!this.hasSemaphoreInstance(r)||this.getSemaphoreInstance(r).canAcquire}acquire(r=e){const n=s(r),i=null!=(o=t(a=r)?0:a.priority)?o:0;var a,o;return this.getSemaphoreInstance(n).acquire(i)}release(t=e){const r=s(t);this.getSemaphoreInstance(r).release(),this.tidy(r)}count(t=e){const r=s(t);return this.hasSemaphoreInstance(r)?this.getSemaphoreInstance(r).count:0}hasTasks(t=e){return this.count(t)>0}async request(t,s=e){try{return await this.acquire(s),await t()}finally{this.release(s)}}async requestIfAvailable(t,s=e){return this.canAcquire(s)?this.request(t,s):null}}class i{constructor(){this._semaphore=new n,this._activeCounts={},this._groupWaiters={}}async acquire(e){var t,s;const r=null!=(t=this._activeCounts[e])?t:0;this._activeCounts[e]=r+1;const n=null!=(s=this._groupWaiters[e])?s:this._semaphore.acquire();this._groupWaiters[e]=n,await n}release(e){const t=this._activeCounts[e];1===t?(this._semaphore.release(),delete this._activeCounts[e],delete this._groupWaiters[e]):this._activeCounts[e]=t-1}}export{i as GroupSemaphore,n as Semaphore};\n//# sourceMappingURL=promise-semaphore.modern.js.map\n","import { type ExecException } from \"child_process\";\n\nconst isExecException = (e: any): e is ExecException =>\n    e &&\n    typeof e === \"object\" &&\n    \"stdout\" in e &&\n    \"stderr\" in e;\n\nconst isPasswordRequiredException = (e: any) => (isExecException(e) && (\n    e.stderr?.trim() ===\n        \"pdfcpu: please provide the correct password\"\n));\n\nexport { isPasswordRequiredException };\n","import { FilePath } from \"@chriscdn/file-cache\";\n\nenum Rotate {\n    DEG_0 = 0,\n    DEG_90 = 90,\n    DEG_180 = 180,\n    DEG_270 = 270,\n}\n\ntype PDFArgs = {\n    pdfFilePath: FilePath;\n    pageIndex: number; // 0-based\n    rotate?: Rotate;\n};\n\ntype PDFCpuPageInfo = {\n    source: FilePath;\n    pageCount: number;\n    version: string;\n    title: string;\n    producer: string;\n    encrypted: boolean;\n    pageSizes: Array<{ width: number; height: number }>;\n};\n\ntype PDFCpuInfo = {\n    header: {\n        version: string;\n        creation: string;\n    };\n    infos: PDFCpuPageInfo[];\n};\n\ntype Options = {\n    userPassword?: string;\n    ownerPassword?: string;\n};\n\nexport {\n    type Options,\n    type PDFArgs,\n    type PDFCpuInfo,\n    type PDFCpuPageInfo,\n    Rotate,\n};\n","import { promisify } from \"util\";\nimport { exec as _exec } from \"child_process\";\nimport path from \"path\";\nimport fs from \"fs/promises\";\nimport { FileCache, FileCacheOptions, FilePath } from \"@chriscdn/file-cache\";\nimport { Semaphore } from \"@chriscdn/promise-semaphore\";\nimport { pathExists } from \"path-exists\";\nimport { Memoize } from \"@chriscdn/memoize\";\nimport sha1 from \"sha1\";\nimport { quote as shellQuote } from \"shell-quote\";\nimport { isPasswordRequiredException } from \"./exceptions\";\nimport {\n    type Options,\n    type PDFArgs,\n    type PDFCpuInfo,\n    type PDFCpuPageInfo,\n    Rotate,\n} from \"./types\";\n\nconst semaphore = new Semaphore();\nconst execPromise = promisify(_exec);\n\nconst optionsToCLI = (\n    options: Options,\n) => [\n    ...(options.userPassword ? [\"-upw\", quote(options.userPassword)] : []),\n    ...(options.ownerPassword ? [\"-opw\", quote(options.ownerPassword)] : []),\n];\n\nexport type PDFSplitFileCacheOptions =\n    & Omit<\n        FileCacheOptions<PDFArgs>,\n        \"cb\" | \"ext\"\n    >\n    & {\n        pdfcpu?: FilePath;\n    };\n\nconst randomDirectoryName = (l = 16) =>\n    [...Array(l)].map(() => Math.random().toString(36)[2]).join(\"\");\n\nconst quote = (text: string) => shellQuote([text]);\n\nclass PDFSplitFileCache extends FileCache<PDFArgs> {\n    private pdfcpu: FilePath;\n\n    constructor(args: PDFSplitFileCacheOptions) {\n        // Make a standalone function that can be recursively called.\n        const cb = async (\n            filePath: FilePath,\n            { pdfFilePath, pageIndex, rotate }: PDFArgs,\n        ) => {\n            const rotateResolved = rotate ?? Rotate.DEG_0;\n\n            if (rotateResolved === Rotate.DEG_0) {\n                try {\n                    // The semaphore prevents multiple consecutive calls (with\n                    // different page numbers) from running the full extraction\n                    // again.\n                    await semaphore.acquire(pdfFilePath);\n\n                    if (await pathExists(filePath)) {\n                        // all done\n                    } else {\n                        // Create a _temp directory in the cache directory to\n                        // hold the temp files. This guarantees the temp files\n                        // are stored on the same volume, which removes problems\n                        // moving the files later.\n                        //\n                        // Orphaned files and empty directories are cleaned up\n                        // by FileCache.\n                        const _thumbnailPath = path.resolve(\n                            args.cachePath,\n                            \"_temp\",\n                            randomDirectoryName(),\n                        );\n\n                        await fs.mkdir(_thumbnailPath, { recursive: true });\n\n                        const command = [\n                            this.pdfcpu,\n                            \"split\",\n                            quote(pdfFilePath),\n                            quote(_thumbnailPath),\n                        ];\n\n                        await execPromise(command.join(\" \"));\n\n                        const pdfFiles = await fs.readdir(_thumbnailPath);\n\n                        await Promise.all(pdfFiles.map(async (pdfFile) => {\n                            const match = pdfFile.match(/_(\\d+)\\.pdf$/);\n\n                            if (match?.[1]) {\n                                // The -1 makes this 0-based\n                                const _pageIndex = parseInt(match[1], 10) -\n                                    1;\n\n                                const sourceFilePath = path.join(\n                                    _thumbnailPath,\n                                    pdfFile,\n                                );\n\n                                const targetFilePath = await this\n                                    .resolveFilePath({\n                                        pdfFilePath,\n                                        pageIndex: _pageIndex,\n                                    });\n\n                                await fs.mkdir(\n                                    path.dirname(targetFilePath),\n                                    {\n                                        recursive: true,\n                                    },\n                                );\n\n                                // same volume, making an fs.rename possible\n                                await fs.rename(\n                                    sourceFilePath,\n                                    targetFilePath,\n                                );\n                            }\n                        }));\n\n                        // After all that, check if we have a file.\n                        if (await pathExists(filePath)) {\n                            // all good\n                        } else {\n                            throw new Error(\n                                `Invalid range or PDF: ${filePath}`,\n                            );\n                        }\n                    }\n                } finally {\n                    semaphore.release(pdfFilePath);\n                }\n            } else {\n                const sourceFilePath = await this\n                    .resolveFilePath({\n                        pdfFilePath,\n                        pageIndex,\n                    });\n\n                await cb(sourceFilePath, {\n                    pdfFilePath,\n                    pageIndex,\n                    rotate: Rotate.DEG_0,\n                });\n\n                const command = [\n                    this.pdfcpu,\n                    \"rotate\",\n                    quote(sourceFilePath),\n                    rotateResolved,\n                    quote(filePath),\n                ];\n\n                await execPromise(command.join(\" \"));\n            }\n        };\n\n        super({\n            ...args,\n            ext: () => \".pdf\",\n            resolveCacheKey: ({ pdfFilePath, pageIndex, rotate }) =>\n                sha1(\n                    JSON.stringify({\n                        pdfFilePath,\n                        pageIndex,\n                        rotate: rotate ?? Rotate.DEG_0,\n                    }),\n                ),\n            cb,\n        });\n\n        this.pdfcpu = args.pdfcpu ?? \"pdfcpu\";\n        this.pdfInfo = Memoize(this.pdfInfo.bind(this));\n    }\n\n    async pdfInfo(\n        pdfFilePath: FilePath,\n        options: Options = {},\n    ): Promise<PDFCpuPageInfo> {\n        const command = [\n            this.pdfcpu,\n            \"info -json\",\n            ...optionsToCLI(options),\n            quote(pdfFilePath),\n        ];\n\n        // console.log(\"**************\");\n        // console.log(command);\n        // console.log(\"**************\");\n\n        const { stdout } = await execPromise(command.join(\" \"));\n        const pdfCpuInfo = JSON.parse(stdout) as PDFCpuInfo;\n        return pdfCpuInfo.infos[0]!;\n    }\n\n    async isPasswordProtected(pdfFilePath: FilePath) {\n        try {\n            await this.pdfInfo(pdfFilePath);\n            return false;\n        } catch (e) {\n            if (isPasswordRequiredException(e)) {\n                return true;\n            } else {\n                throw e;\n            }\n        }\n    }\n\n    async pageCount(\n        pdfFilePath: FilePath,\n    ): Promise<PDFCpuPageInfo[\"pageCount\"]> {\n        const { pageCount } = await this.pdfInfo(pdfFilePath);\n        return pageCount;\n    }\n\n    async pages(\n        pdfFilePath: FilePath,\n    ): Promise<FilePath[]> {\n        const pageCount = await this.pageCount(pdfFilePath);\n\n        return await Promise.all(\n            Array.from(\n                { length: pageCount },\n                (_, i) => this.getFile({ pdfFilePath, pageIndex: i }),\n            ),\n        );\n    }\n}\n\nexport { PDFSplitFileCache, Rotate };\n"],"names":["isExecException","e","isPasswordRequiredException","_e$stderr","stderr","trim","Rotate","semaphore","Semaphore","execPromise","promisify","_exec","optionsToCLI","options","userPassword","quote","ownerPassword","randomDirectoryName","l","Array","map","Math","random","toString","join","text","shellQuote","PDFSplitFileCache","FileCache","constructor","args","_args$pdfcpu","cb","filePath","pdfFilePath","pageIndex","rotate","rotateResolved","DEG_0","acquire","pathExists","_thumbnailPath","path","resolve","cachePath","fs","mkdir","recursive","command","pdfcpu","pdfFiles","readdir","Promise","all","pdfFile","match","_pageIndex","parseInt","sourceFilePath","targetFilePath","resolveFilePath","dirname","rename","Error","release","ext","resolveCacheKey","sha1","JSON","stringify","pdfInfo","Memoize","bind","stdout","pdfCpuInfo","parse","infos","isPasswordProtected","pageCount","pages","from","length","_","i","getFile"],"mappings":"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"}